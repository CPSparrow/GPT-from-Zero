# ä»0å¼€å§‹çš„**ä¸­æ–‡GPT-2**è®­ç»ƒå†’é™©ğŸ˜˜ï¸

## è¿›åº¦(Updates)

- 25.03.15:

  è®ºæ–‡æ±‡æŠ¥æš‚æ—¶å‘Šä¸€æ®µè½ï¼Œå¤šå‡ºæ¥çš„æ—¶é—´åº”è¯¥ä¼šæ‹¿æ¥é‡æ„è¿™ä¸ªé¡¹ç›®ä»è€Œå‡†å¤‡ä¸‹ä¸€æ¬¡è®­ç»ƒã€‚

  é‡è¦çš„å‚è€ƒèµ„æ–™ï¼š[çŸ¥ä¹ - Training Arguments](https://zhuanlan.zhihu.com/p/662619853)

  è®¡åˆ’æ˜¯åˆ†ä¸ºä¸‰æ­¥èµ°ï¼š
    - æ•´ç†ã€é˜…è¯»åŸå…ˆä»£ç 
    - é‡å†™dataloaderä»¥åŠç›¸å…³éƒ¨åˆ†ï¼Œä¸­é—´å¯èƒ½ä¼šæ¶‰åŠ `dataclass` çš„å­¦ä¹ ã€‚
    - å¯èƒ½ä¼šä½¿ç”¨æ‰‹åŠ¨è®¾è®¡çš„ä»£ç è®­ç»ƒï¼ŒéªŒè¯å’Œä¿å­˜æ¨¡å‹ã€‚
- 25.03.01:\
  ä½¿ç”¨å¹³å°çš„vGPUå¼€å§‹è®­ç»ƒã€‚æ€»å…±çº¦ `7.7GB` çš„æ•°æ®ï¼Œ230M+ (?) å‚æ•°çš„æ¨¡å‹,è®¾è®¡äº† learning_rate = 2.5e-4, weight_decay =
  0.0001ã€‚å®Œæ•´è®­ç»ƒå®Œä¼°è®¡ç”¨æ—¶è¶…è¿‡300å°æ—¶ï¼Œè‚¯å®šä¸ä¼šæŠŠ100ä¸ª epoch éƒ½è·‘å®Œã€‚\
  > äº‹åç¬”è®°ï¼šå¹¶é7GBï¼Œå®é™…ä¸Šè¦å°‘çš„å¤š

  å¼€å§‹è®­ç»ƒä¹‹åè®¸ä¹…æ‰å‘ç°ä¸€ä¸ªå¾ˆå¥½çš„æ•™ç¨‹ï¼Œæ¥è‡ª huggingface
  çš„[NLP Course](https://huggingface.co/learn/nlp-course/zh-CN/chapter7/6?fw=pt)ã€‚å¯¹æ¯”ä¹‹ä¸‹æ„Ÿè§‰è¿™ä¸€æ¬¡çš„è®­ç»ƒç»“æœä¸ä¼šä¹è§‚ã€‚\
  å‡ ä¸ªä¸»è¦çš„å·®å¼‚ï¼š
    - æ²¡æœ‰æ‰‹åŠ¨è®¾ç½® warmup å’Œ lr_scheduler
    - courseä¸­å±…ç„¶åªç”¨äº†ä¸€ä¸ªepochæ•ˆæœå°±å¾ˆå¥½ã€‚éš¾ä»¥ç½®ä¿¡ã€‚
    - å¯¹äºç¤ºä¾‹çš„å°æ¨¡å‹(124M), lr æ›´é«˜ï¼Œè¾¾åˆ° 5e-4 ; weight_decay ä¹Ÿæ›´é«˜ï¼Œè¾¾åˆ° 0.1 (è€Œæˆ‘æ ¹æ®çŸ¥ä¹ä¸ŠæŸç¯‡æ–‡ç« é€‰æ‹©äº† 1e-4 )
    - ä¹Ÿæ˜¯æˆ‘æ¬ ç¼ºè€ƒè™‘ï¼Œè®¾ç½®äº†è¿‡å¤§çš„ max_length: 1024 tokensã€‚æ•™ç¨‹ä¸­çš„ 128 tokens å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå¼€å¤´ä¸åº”è¯¥å¤ªè´ªå¿ƒã€‚

  æ ¹æ®ç›®å‰çš„è®¾ç½®å†è®­ç»ƒä¸€ä¼šå„¿(ä¹Ÿè®¸ä¸€å¤©ï¼Œä¹Ÿè®¸å¤šä¸€ç‚¹)ï¼Œçœ‹çœ‹ç»“æœå†è¯´å§ã€‚
- 25.02.28:\
  ä½¿ç”¨L20è®­ç»ƒäº†4ä¸ªå°æ—¶å¤šä¸€ç‚¹çš„æ—¶é—´ï¼Œå¤§æ¦‚æ˜¯16_0000æ¡æ•°æ®(?)
  ä¸¤ä¸ªepochã€‚å› ä¸ºæ•°æ®çš„æ”¹åŠ¨ä¸»è¦åœ¨æœåŠ¡å™¨æ‰€ä»¥ç»†èŠ‚æœ‰äº›é—å¿˜ã€‚ç»“è®ºæ˜¯æ•ˆæœæœç„¶å¾ˆå·®ï¼Œåªä¼šå¤è¯»æ— æ„ä¹‰çš„ç¬¦å·ã€‚å› æ­¤é‡æ–°é€Ÿè¯»äº†GPT1ã€2çš„è®ºæ–‡ï¼Œå¯¹æ¯”ä¸‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä¸åŒï¼Œå¯èƒ½æ˜¯è®­ç»ƒæ•ˆæœå·®çš„åŸå› ï¼š
    - å­¦ä¹ ç‡å¤ªä½ã€‚åŸå…ˆçš„è®¾ç½®éµå¾ªäº†hugginfaceçš„è®¾ç½®ï¼Œä½†æ˜¯2e-5æ˜¯æŒ‰ç…§å¾®è°ƒçš„æƒ…å†µè®¾ç½®çš„
    - è®­ç»ƒå¤ªå°‘ã€‚gpt1ä¸­ä¼¼ä¹æåˆ°æ€»å…±è®­ç»ƒäº†100ä¸ªepochï¼Œè€Œgpt2ä¸­åˆæåˆ°åŸå§‹çš„æ•°æ®(å¦‚æœç®—ä¸Šåæ¥è¢«æ¸…é™¤çš„WikiText)
      åˆ™æœ‰è¶³è¶³40GBã€‚å‡å¦‚è¯´æ˜¯1.5B -> 40GB,é‚£ä¹ˆç­‰æ¯”ä¾‹æ¥çœ‹æœ¬æ¬¡ç ”ç©¶çš„0.3Bæ¨¡å‹åº”å½“æ˜¯8GBã€‚
      ä¸è¿‡è¿™ä¸€æ–¹é¢è¿˜ä¸æ˜¯å¾ˆç¡®å®šï¼Œå¯èƒ½è¿˜å¾—å†çœ‹ä¸€äº›èµ„æ–™æ¥å†³å®šã€‚
    - åŸºäºAmper(L20)çš„ä¿®æ”¹è¿˜æ²¡æœ‰åŒæ­¥ï¼Œæœ¬æ¬¡æäº¤çš„ä¸»è¦æ˜¯æ•´ç†bpeçš„ä»£ç ä»¥åŠæœ¬åœ°çš„é‡æ–°è®­ç»ƒçš„åˆ†è¯å™¨(åˆ†åˆ«æ˜¯7ä¸ªepochçš„
      ```32k_v1```å’Œ14ä¸ªepochçš„```32k_v2```),æ¯”è¾ƒä¹‹åä¹Ÿæ˜¯ç¡®å®šäº†ç›®å‰æ¥è¯´ä¼¼ä¹v1ä¾¿å·²ç»è¶³å¤Ÿåˆé€‚ã€‚
- 25.02.26:\
  ç”¨8_0000è¡Œ(çº¦228MB)ä¸­æ–‡è®­ç»ƒäº†ä¸¤ä¸ªepochï¼Œä½†æ˜¯æ¨¡å‹å®Œå…¨æ— æ³•è¾“å‡ºã€‚\
  ä¸¾ä¾‹ï¼š\
  è¾“å…¥ï¼šæ‘æ°‘ä»¬éƒ½å¾ˆé«˜å…´\
  è¾“å‡ºï¼šæ‘æ°‘ä»¬éƒ½å¾ˆé«˜å…´ï¼Œåœ¨â€œâ€œâ€œâ€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œâ€œ\
  åŸå› çŒœæµ‹ï¼š
    - vocab_size,embed_dimæˆ–æ˜¯train_stepså¤ªå°å¯¼è‡´çš„è®­ç»ƒä¸è¶³(è®­ç»ƒæ—¶eval loss > 7)
    - è¡¥å……ï¼šä¹Ÿæœ‰å¯èƒ½æ˜¯weight_decayçš„åŸå› ã€‚è‡³äºå…¶ä»–çš„è¶…å‚æ•°åˆ™ä¸æ¸…æ¥šäº†ã€‚
- 25.02.25:\
  é‡å†™äº†BPEçš„è®­ç»ƒã€‚åŸºäºAutoTokenizerçš„è®­ç»ƒä½¿å¾—åç»­å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨ã€‚åŒæ—¶åŸºæœ¬å†™å¥½äº†è®­ç»ƒçš„æ¡†æ¶(å³```prepare.py```æ–‡ä»¶)
  ã€‚ç¨åçš„ä»»åŠ¡æ˜¯è°ƒæ•´æ­£ç¡®çš„DataLoaderå’ŒDataCollector
- 25.02.24:\
  å‘¨æœ«ä¼‘æ¯ä¹‹åé‡æ–°æŸ¥é˜…èµ„æ–™ï¼Œå‡†å¤‡é‡å†™ä»£ç ã€‚å¯¹äºæ¥ä¸‹æ¥çš„åŸºæœ¬è®¡åˆ’å¦‚ä¸‹
    - å€ŸåŠ©AutoTokenizersé‡æ–°è®­ç»ƒBPE(è€Œä¸”ä¼¼ä¹è¿™æ ·å¯ä»¥ç›´æ¥å¾—åˆ°FastTokenizer),éœ€è¦é€‚å½“è°ƒæ•´special tokens
    - æŸ¥è¯¢ç±»ä¼¼çš„æ–¹æ³•åˆå§‹åŒ–GPT2æ¨¡å‹å¹¶è®­ç»ƒ

    - ç›®å‰ä¸æ˜¯å¾ˆç¡®å®šçš„éƒ¨åˆ†: Padding Strategy çš„å¤„ç†å’Œæˆªæ–­çš„å¤„ç†

- 25.02.20:\
  bpeä»£ç åŸºæœ¬å®Œæˆï¼Œéšåå‘ç°è®­ç»ƒbpeåªéœ€è¦å¤§çº¦1GBçš„æ•°æ®å³å¯ï¼Œè€ŒéåŸå…ˆé¢„æƒ³çš„è¦æŠŠæ‰€æœ‰æ•°æ®è·‘ä¸€é(å–œ)
- 25.02.18ï½29:\
  ä¸‹è½½æ•°æ®é›†ï¼Œç†Ÿæ‚‰è¯»å–ä»£ç 

## æ•°æ®æ¥æº(éƒ¨åˆ†ä¸è€ƒè™‘)

- ä¼ ç»Ÿæ–‡åŒ–: è¿˜éœ€æ¸…æ´—ï¼Œæ‡’å¾—æå°±ä¸æäº†
- **åŸºç¡€è¯­æ–™**:ç›®å‰å°±ç”¨è¿™ä¸ªäº†ï¼Œè´¨é‡æ¯”è¾ƒé«˜çš„ä¸­æ–‡è¯­æ–™ï¼Œç½‘å®‰å¹³å°ä¸‹è½½çš„
- cci: æ¥æºåŒä¸Šï¼Œè¿˜æ²¡ä¸‹è½½æ¥
- oscar: æ¥è‡ªmnbvcçš„crawleræ–‡ä»¶å¤¹
- ~~[CLUECorpus2020](https://github.com/CLUEbenchmark/CLUECorpus2020)~~ é€šè¿‡ç™¾åº¦ç½‘ç›˜æä¾›ï¼Œæ‰€ä»¥ä¸æƒ³æ
- [liwu/MNBVC](https://huggingface.co/datasets/liwu/MNBVC) è¶…å¤§è§„æ¨¡æ•°æ®é›†ï¼Œoscaræ˜¯common crawlçš„æ¸…æ´—ï¼Œå¯ä»¥ä½œä¸ºåˆæ­¥é¢„è®­ç»ƒçš„è¯­æ–™ã€‚
- [c4](https://hf-mirror.com/datasets/allenai/c4/tree/main/en) å¯ä»¥ä½œä¸ºè‹±æ–‡è®­ç»ƒ
- [smoltalk](https://opencsg.com/datasets/OpenCSG/smoltalk_chinese/files/main/data) ä½œä¸ºsftè¯­æ–™

## è§„åˆ’(æœ€åˆçš„è®¾æƒ³ï¼Œå¹¶éæœ€æ–°)

æœ€å¼€å§‹çš„è§„æ¨¡åº”è¯¥å‘gpt-2çœ‹é½(ä¹Ÿè®¸å§)ã€‚

0. è®­ç»ƒtokenizer -> BPE ~~å’Œembedding(?)~~
    - å·²å®Œæˆ: æµ‹è¯•```load_jsonl```å‡½æ•°
    - å·²å®Œæˆ(ç•¥å¾®å­˜ç–‘ï¼Ÿ): BBPE
1. åŸºç¡€Transfomer
    - ä½¿ç”¨torchï¼Œæˆ–è€…transformers?
2. ä¼˜åŒ–çš„transformer:RoPE,flash attention,swiæ¿€æ´»å‡½æ•°ï¼Œä¹Ÿè®¸è¿˜æœ‰å…¶ä»–
    - å¤šå¡è®­ç»ƒ
    - æ›´å¤§æ¨¡å‹
    - accelerateåº“
3. MoEæ¶æ„ï¼ŒDS MoEï¼Ÿ
